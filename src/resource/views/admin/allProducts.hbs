<div class="admin-all-products-container">  
  <div class="board-title">
    <p>Tổng sản phẩm: {{productLength}}</p>
  </div>

  <div class="filter-and-create">
    <select class="filter">
      <option value="">Toàn bộ</option>
      <option value="skincare">Skincare</option>
      <option value="makeup">Makeup</option>
    </select>

    <a href="/admin/all-products/product/create" class="create-btn" id="create-btn">
      <i class="fi fi-br-layer-plus"></i>
      <p>Thêm Sản Phẩm</p>
    </a>
  </div>

  <div class="table">
    <table class="all-items">
      <thead>
        <tr>
          <td style="width:  5%">STT     </td>
          <td style="width: 15%">Hãng    </td>
          <td style="width: 30%">Tên     </td>
          <td style="width: 10%">Loại    </td>
          <td style="width: 20%">Giá     </td>
          <td style="width: 10%">Số lượng</td>
          <td style="width: 10%">Thao tác</td>
        </tr>
      </thead>

      <tbody>
        {{#each product}}
        <tr>
          <td>{{addIndex @index 1}}</td>
          <td>{{this.brand}}</td>
          <td style="
                display: flex; 
                justify-content: start;
                align-items: center;
                "
          >
            <img src="{{this.img.path}}" alt="{{this.name}}" loading="lazy" loading="lazy"> 
            <p>{{this.name}}</p>
          </td>  
          <td>{{this.categories}}</td>
          <td id="product-price">{{this.price}}</td>
          <td id="product-quantity">{{this.quantity}}</td>
          <td>
            <a href="/admin/all-products/product/{{this._id}}" class="update-button"><button>Chi tiết</button></a>
            <button id="{{this._id}}" name="{{this.name}}" onclick="reply_click(this.id, this.name)">Xoá</button> 
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>

    <div id="id01" class="modal">
      <form class="modal-content">
        <div class="container">
          <p><strong>Xoá sản phẩm ?</strong></p>
          <p id="confirm-message"></p>
          <div class="clearfix">
            <button id="delete-button" type="button" class="deletebtn">Xoá</button>
            <button type="button" onclick="document.getElementById('id01').style.display='none'" class="cancelbtn">Huỷ</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <span class="pagination">
  </span>
</div>

<form style="display: none;" name="delete-form" method="post"></form>

<script>
  // display delete confirmation box
  let courseId;
  let deleteForm   = document.forms['delete-form']
  let deleteButton = document.getElementById('delete-button')
  let formButton   = document.getElementsByClassName('form-button')
  var productPrice = document.querySelectorAll('td#product-price')

  productPrice.forEach((price) => {price.innerText = price.innerText.replace(/\B(?=(\d{3})+(?!\d))/g, '.') + ' VND'})

  function reply_click(clicked_id, clicked_name) {
    const name = clicked_name
    const message = document.querySelector('p#confirm-message')
    message.innerText = `Bạn có muốn xoá sản phẩm ${name} không ?`
    document.getElementById('id01').style.display='block'
    courseId = clicked_id
  }

  // delete action
  deleteButton.onclick = function () {
    deleteForm.action = '/admin/all-products/product/soft-delete/' + courseId + '?_method=DELETE'
    deleteForm.submit()
  }

  // pagination 
  var pagination = document.querySelector('span.pagination')
  var productLength = `{{productLength}}`
  var currentPage = 1

  // díplay all pages tag
  for (let i = 0; i < productLength; i += 10) {
    var newPage = document.createElement('a')
    newPage.setAttribute('href', `/admin/all-products?page=${currentPage}&type={{productType}}`)
    newPage.innerText = `${currentPage}`
    pagination.appendChild(newPage)
    currentPage++
  }

  // Style the current selected page
  var allPagesTag = pagination.querySelectorAll('a')
  for (let i = 0; i < allPagesTag.length; ++i) {
    if (allPagesTag[i].innerText === `{{currentPage}}`) {
      allPagesTag[i].style.borderColor = '#D1A6A6'
      allPagesTag[i].style.backgroundColor = '#D1A6A6'
      allPagesTag[i].style.color = 'white'
      allPagesTag[i].style.width = '25px'
      allPagesTag[i].style.height = '25px'
    }
  }
  
  // filter button logic
  let selectButton = document.querySelector('select')
  selectButton.onchange = function () {
    location = `/admin/all-products?page=1&type=${this.value}`
  }

  let selectButtonOptions = selectButton.querySelectorAll('option')

  selectButtonOptions.forEach(option => {
    if (option.value === `{{productType}}`) {
      option.setAttribute('selected', 'selected')
    }
  })
</script>
