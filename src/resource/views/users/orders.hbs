<div class="order-container">
  <div class="progress">
    <span>1</span>
    <progress id="first-progress" value="0" max="100"></progress>
    <span>2</span>
    <progress id="second-progress" value="0" max="100"></progress>
    <span>3</span>
    <progress id="third-progress" value="0" max="100"></progress>
    <span>4</span>
  </div>

  <form action="/orders/create-orders" method="post">
    <div class="cart">
      <p>Giỏ hàng của tôi</p>
      <table>
        <tr>
          <th>Tên Sản Phẩm</th>
          <th>Giá</th>
          <th>Số Lượng</th>
          <th>Tổng Tiền</th>
          <th>Xoá</th>
        </tr>
      </table>
    </div>

    <div class="delivery">
      <p>Chọn hình thức giao hàng</p>

      <input type="radio" id="direct" name="delivery" value="direct">
      <label for="direct">Nhận hàng tại chi nhánh </label><br>
      
      <input type="radio" id="indirect" name="delivery" value="indirect">
      <label for="indirect">Giao hàng tại địa chỉ người nhận</label>
    </div>

    <div class="contact-info">
      <p>Nhập thông tin khách hàng</p>

      <label for="name">Tên người mua</label>
      <input type="text" id="name" name="name">
      <span class="form-message"></span><br>

      <label for="phone-number">Số điện thoại</label>
      <input type="text" id="phone-number" phone-number="name">
      <span class="form-message"></span><br>

      <label for="note">Ghi chú</label>
      <input type="text" id="note" name="note">
      <span class="form-message"></span>
    </div>

    <div class="total-expense">
      <p>Tổng tiền hàng</p>
      <p>100000</p>
    </div>

    <div class="button">
      <button title="submit" type="submit" class="submit-button">Hoàn thành</button>
    </div>
  </form>

  <div class="button">
    <button class="next-button">Tiếp theo</button>
  </div>
</div>

<script>

  // display each process logic
  var getDelivery = document.querySelector('div.delivery')
  var getContactInfo = document.querySelector('div.contact-info')
  var getTotalExpense = document.querySelector('div.total-expense')
  var getNextButton = document.querySelector('button.next-button')
  var getSubmitButton = document.querySelector('button.submit-button')
  var getProgressMarks = document.querySelector('div.progress').querySelectorAll('span')
  var getProgressBars = document.querySelectorAll('progress')

  getProgressMarks[0].style.backgroundColor = '#D1A6A6'
  getProgressMarks[0].style.color = 'white'

  // set default display to 'none' on start
  getDelivery.style.display = 'none'
  getContactInfo.style.display = 'none'
  getTotalExpense.style.display = 'none'
  getSubmitButton.style.display = 'none'

  getNextButton.onclick = function() {
    if (getDelivery.style.display === 'none') {
      getDelivery.style.display = 'block'

      getProgressMarks[1].style.backgroundColor = '#D1A6A6'
      getProgressMarks[1].style.color = 'white'

      getProgressBars[0].value = '100'
      getProgressBars[0].style.accentColor = '#D1A6A6'
    } 
    else if (getContactInfo.style.display === 'none') {
      getContactInfo.style.display = 'grid'

      getProgressMarks[2].style.backgroundColor = '#D1A6A6'
      getProgressMarks[2].style.color = 'white'

      getProgressBars[1].value = '100'
      getProgressBars[1].style.accentColor = '#D1A6A6'
    } 
    else {
      getTotalExpense.style.display = 'block'

      getProgressMarks[3].style.backgroundColor = '#D1A6A6'
      getProgressMarks[3].style.color = 'white'

      getProgressBars[2].value = '100'
      getProgressBars[2].style.accentColor = '#D1A6A6'
    }

    if (getTotalExpense.style.display === 'block') {
      getNextButton.style.display = 'none'
      getSubmitButton.style.display = 'block'
    }
  }

  // get data to display from localStorage
  var getProductInfo = JSON.parse(localStorage.getItem('product_cart_count')) || {};
  var productInfoLength = getProductInfo.productInfo.length 
  var getTable = document.querySelector('table')
  var totalOrderPrice = 0

  // create new row for new product have name, price, quantity and totalPrice
  for (let i = 0; i < productInfoLength; ++i) {
    // create new row
    var newProductRow = document.createElement('tr') 

    // create new element and get data from localStorage
    var newProductName = document.createElement('td')
    newProductName.innerText = getProductInfo.productInfo[i].name 
    var newProductPrice = document.createElement('td')
    newProductPrice.innerText = getProductInfo.productInfo[i].price 
    var newProductQuantity = document.createElement('td')
    newProductQuantity.innerText = getProductInfo.productInfo[i].quantity
    var newProductTotalPrice = document.createElement('td')
    newProductTotalPrice.innerText = getProductInfo.productInfo[i].price * getProductInfo.productInfo[i].quantity
    
    // calculate all product prices
    totalOrderPrice += getProductInfo.productInfo[i].price * getProductInfo.productInfo[i].quantity

    // add each element to the row
    newProductRow.appendChild(newProductName)
    newProductRow.appendChild(newProductPrice)
    newProductRow.appendChild(newProductQuantity)
    newProductRow.appendChild(newProductTotalPrice)

    // add each row to the table
    getTable.appendChild(newProductRow)
  }

  // calculate total ordersPrice
  var totalOrder = document.createElement('tr')
  var totalOrderTitle = document.createElement('td')
  totalOrderTitle.innerText = 'Tổng Đơn Hàng'
  var totalOrderPrices = document.createElement('td')
  totalOrderPrices.innerText = totalOrderPrice

  // add each element to the total order row
  totalOrder.appendChild(totalOrderTitle)
  totalOrder.appendChild(document.createElement('td'))
  totalOrder.appendChild(document.createElement('td'))
  totalOrder.appendChild(totalOrderPrices)

  // add total order row to the bottom of the table
  getTable.appendChild(totalOrder)


</script>