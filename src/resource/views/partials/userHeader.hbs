<div class="store-logo">
  <a href="/home">
    <image src="../../../img/logo.jpg"/>
  </a>

  <div class="responsive-menu" style="display: none;">
    <i class="fi fi-br-bars-sort"></i>
  </div>
</div>

<div class="menu">
  <div class="dropdown">
    <div class="dropdown-title">
      <i class="fi fi-br-menu-burger"></i>
      <p>DANH MỤC SẢN PHẨM</p> 
    </div>

    <ul>
      <li>
        <a href="/all-products/skincare">
          Skincare
          <i class="fi fi-rr-angle-small-right" style="padding-top: 5px;"></i>
        </a>
        <ul>
            <li>
              <a href="/all-products/skincare/xit-khoang">
                Xịt khoáng
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647064/cHJvZHVjdHMvYmozc2ZhZTRkeGllb2psY2s4aWk=/preview" alt="">
              </a>
            </li>

            <li>
              <a href="/all-products/skincare/mat-na">
                Mặt nạ
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710648052/cHJvZHVjdHMveWNtMG9ucXM2MjRsaHMyaDczZDM=/preview" alt="">
              </a>
            </li>

            <li>
              <a href="/all-products/skincare/serum">
                Serum
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710648014/cHJvZHVjdHMvc2ZzY3p6emFjc3JudjBveHB3NHQ=/preview" alt="">
            </a>
            </li>

            <li>
              <a href="/all-products/skincare/bha">
                BHA
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647156/cHJvZHVjdHMvaXRwZncycnZiZ2x3amxsZm1md2Q=/preview" alt="">
            </a>
            </li>

            <li>
              <a href="/all-products/skincare/tay-da-chet">
                Tẩy da chết
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647212/cHJvZHVjdHMvYXFqcjlhZDlrMWdzb2x0dWNzM3I=/preview" alt="">
              </a>
            </li>

            <li>
              <a href="/all-products/skincare/duong-da">
                Dưỡng da
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647079/cHJvZHVjdHMvYnNiaHFoMm1jdWE4b2trZndwY3E=/preview" alt="">
              </a>
            </li>

            <li>
              <a href="/all-products/skincare/toner">
                Toner
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647707/cHJvZHVjdHMvajNnbWtrbmxodGp1cnU4aWc1aW0=/preview" alt="">
              </a>
            </li>

            <li>
              <a href="/all-products/skincare/nuoc-tay-trang">
                Nước tẩy trang
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647750/cHJvZHVjdHMvZDg1amlmanBnZGdhMTVrenBha2E=/preview" alt="">
              </a>
            </li>

            <li>
              <a href="/all-products/skincare/cham-mun">
                Chấm mụn
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647968/cHJvZHVjdHMvYWFyMmpxc2x3ZTlza2RidG1yb3Y=/preview" alt="">
              </a>
            </li>
            
            <li>
              <a href="/all-products/skincare/kem-duong-am">
                Kem dưỡng ẩm
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710648227/cHJvZHVjdHMvdGl2azJ0ZTNlY2hpcmhlbXljdXA=/preview" alt="">
              </a>
            </li>

            <li>
              <a href="/all-products/skincare/sua-rua-mat">
                Sữa rửa mặt
                <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710648203/cHJvZHVjdHMvenk4YXBsaGd1emxzdWNtbGZ3Z3Q=/preview" alt="">
              </a>
            </li>
        </ul>
      </li>
      <li>
        <a href="/all-products/makeup">
          Makeup
          <i class="fi fi-rr-angle-small-right" style="padding-top: 5px;"></i>
        </a>
        <ul>
          <li>
            <a href="/all-products/makeup/phan-ma">
              Phấn má
              <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647688/cHJvZHVjdHMvaWM5b29ka2tzZ3F1aW1vYndrM3U=/preview" alt="">
            </a>
          </li>
          <li>
            <a href="/all-products/makeup/mascara">
              Mascara
              <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647373/cHJvZHVjdHMvbHdnZmVjYWpzMHNxdnBrYWxwaXA=/preview" alt="">
            </a>
          </li>
          <li>
            <a href="/all-products/makeup/ke-mat">
              Kẻ mắt
              <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647427/cHJvZHVjdHMvZ2d4M3dleDQ1em96YTFyd2xuczM=/preview" alt="">
            </a>
          </li>
          <li>
            <a href="/all-products/makeup/kem-chong-nang">
              Kem chống nắng
              <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710648070/cHJvZHVjdHMvZGVyNmRsNG1jNjYwdnZ6dXFmdm8=/preview" alt="">
            </a>
          </li>
          <li>
            <a href="/all-products/makeup/che-khuyet-diem">
              Che khuyết điểm
              <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710648154/cHJvZHVjdHMvZm13a3RoZGJ5cnpzZHpjdGluZDQ=/preview" alt="">
            </a>
          </li>
          <li>
            <a href="/all-products/makeup/son">
              Son
              <img src="https://res-console.cloudinary.com/bunny-store/thumbnails/v1/image/upload/v1710647180/cHJvZHVjdHMvc2Z5YWVqdWVtaHl4YWRweHJqOWs=/preview" alt="">
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </div>

  <div class="title">
    <a href="/introduce">GIỚI THIỆU</a>
  </div>

  <div class="title">
    <a href="/all-products/new-arrival">HÀNG MỚI VỀ</a>
  </div>

  <div class="title">
    <a href="/all-orders/checking">ĐƠN HÀNG</a>
  </div>

  <div class="title">
    <i class="fi fi-br-search" ></i>
  </div>
</div>

<div class="header-button">
  <a href="/all-orders" class="orders">
    <span class="orders-quantity"></span>    
    <i class="fi fi-rr-shopping-cart-add"></i>
  </a>

  <img src="../../../img/4.jpg" class="dropdown-avatar" alt="loading"/>
</div>

<div class="avatar-menu">
</div>

<form method="get" action="" class="search-form">
</form>

<script>
  // update cart-orders base on each user using local storage
  var getOrdersQuantity = document.querySelector('span.orders-quantity')
  
  function updateCartCount() {
    var countObject = JSON.parse(localStorage.getItem('product_cart_count')) || {};
      var countOrdersQuantity = countObject.localCounting || 0;
      getOrdersQuantity.innerText = countOrdersQuantity
    }

  document.addEventListener('cartUpdated', updateCartCount);
  updateCartCount()

  // onclick search icon
  var getSearchIcon = document.querySelector('i.fi-br-search')
  var getForm = document.querySelector('form.search-form')
  getForm.style.display = 'none'

  // create input element
  var searchInput = document.createElement('input')
  searchInput.setAttribute('id', 'search-input')
  searchInput.setAttribute('type', 'text')
  searchInput.setAttribute('placeholder', 'nhập mã hàng, tên sản phẩm để tìm kiếm')

  getSearchIcon.onclick = function() {
    if (getForm.style.display === 'none') {
      getForm.style.display = 'block'
      getForm.appendChild(searchInput)
    } 
    else {
      getForm.style.display = 'none'
      getForm.removeChild(searchInput)
    }
  }

  // onclick avatar
  var getAvatarMenu = document.querySelector('div.avatar-menu')
  var getAvatar = document.querySelector('img.dropdown-avatar')
  getAvatarMenu.style.display = 'none'

  getAvatar.onclick = function() {
    if (getAvatarMenu.style.display === 'none') {
      getAvatarMenu.style.display = 'block'
    } else {
      getAvatarMenu.style.display = 'none'
    }
  }

  document.addEventListener('click', function(event) {
  if (!event.target.matches('.dropdown-avatar') &&
      !event.target.closest('.dropdown-avatar') 
    ) { 
    getAvatarMenu.style.display = 'none'
  }
});

  // update avatar logged-in or not logged-in
  function getCookie(cname) {
    let name = cname + "=";
    let decodedCookie = decodeURIComponent(document.cookie);
    let ca = decodedCookie.split(';');
    for(let i = 0; i <ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }

  var token = getCookie('auth_token')
  var user_id = getCookie('user_id')
  if (token) {
    var updateProfileButton = document.createElement('a')
    updateProfileButton.innerText = 'Thông tin cá nhân'
    updateProfileButton.setAttribute('href', `/profile/update/${user_id}`)
    getAvatarMenu.appendChild(updateProfileButton)

    var logOutButton = document.createElement('a')
    logOutButton.innerText = 'Đăng Xuất'
    logOutButton.setAttribute('href', '/home')
    getAvatarMenu.appendChild(logOutButton)
  } 
  else {
    var logInButton = document.createElement('a')
    logInButton.innerText = 'Đăng nhập'
    logInButton.setAttribute('href', '/authentication/sign-in')
    getAvatarMenu.appendChild(logInButton)
  }

  // log-out and clear cookie
  if (logOutButton) {
    logOutButton.onclick = function() {
      document.cookie = "auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      document.cookie = "user_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    }
  }

  // resposive menu
  var responsiveMenu = document.querySelector('div.responsive-menu')
  var menu = document.querySelector('div.menu')
  var width = window.innerWidth

  function setDisplay(width, menu) {
    if (width < 700) {
      menu.style.display = 'none'
    } else {
      menu.style.display = 'flex'
    }
  }
  setDisplay(width, menu)

  window.addEventListener("resize", function() {
    width = window.innerWidth
    setDisplay(width, menu)
  });

  responsiveMenu.onclick = function() {
    if (menu.style.display === 'none') {
      menu.style.display = 'flex'
    } else {
      menu.style.display = 'none'
    }
  }
  
  
</script>